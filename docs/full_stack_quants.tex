\documentclass{beamer}
\usepackage{color}
\definecolor{deepblue}{rgb}{0,0,0.5}
\definecolor{deepred}{rgb}{0.6,0,0}
\definecolor{deepgreen}{rgb}{0,0.5,0}

\usepackage{listings}

\AtBeginSection[]
{
  \begin{frame}
    \frametitle{Table of Contents}
    \tableofcontents[currentsection]
  \end{frame}
}

\usetheme{PaloAlto}
\usecolortheme{seahorse}

\lstset{
	showstringspaces=false,
	keywordstyle=\color{deepblue},
	emph={Python.h, PyObject, PyArg_ParseTuple, PyMODINIT_FUNC, PyModule_Create, PyModuleDef, PyModuleDef_HEAD_INIT, PyMethodDef, PyCFunction, METH_VARARGS},          % Custom highlighting
	emphstyle=\color{deepred},    % Custom highlighting style
	stringstyle=\color{deepgreen},
	breakatwhitespace=false,         % sets if automatic breaks should only happen at whitespace
  	breaklines=true                 % sets automatic line breaking
}

\title{You can call your C++ code from Python}
\author{Jack Grahl}
\institute{PrismFP Analytics}

\begin{document}
	%\frame{\titlepage}

	\section{Making a package}

	\subsection{setuptools}
	\begin{frame}[fragile]
		\frametitle{setuptools}
		\begin{lstlisting}[language=Python]
from setuptools import setup

setup(
    name='calexicon',
    version='0.1.2',
    description='Calendar stuff',
    url='http://github.com/jwg4/calexicon',
    author='Jack Grahl',
    author_email='jack.grahl@gmail.com',
    license='Apache License 2.0',
    packages=['calexicon'],
    test_suite='nose.collector',
    tests_require=['nose', 'hypothesis']
)
		\end{lstlisting}
	\end{frame}

	\section{PyObjects}

	\subsection{Python.h}
	\begin{frame}[fragile]
		\frametitle{Python.h}
		\begin{lstlisting}[language=C++]
#include <Python.h>
#include "Quantuccia/ql/time/calendar.hpp"
#include "Quantuccia/ql/time/date.hpp"
#include "Quantuccia/ql/time/calendars/unitedkingdom.hpp"
		\end{lstlisting}
	\end{frame}

	\subsection{PyObject *args}
	\begin{frame}[fragile]
		\frametitle{PyObject *args}
		\begin{lstlisting}[language=C++]
   static PyObject*
united_kingdom_is_business_day(PyObject *self, PyObject *args)
{
    int year;
    int month;
    int day;
    if (!PyArg_ParseTuple(args, "iii|", \&year, \&month, \&day))
        return NULL;
    QuantLib::Day d(day);
    QuantLib::Month m = static_cast<QuantLib::Month>(month);
    QuantLib::Year y(year);
		\end{lstlisting}
	\end{frame}

	\subsection{PyBool\_FromLong}
	\begin{frame}[fragile]
		\frametitle{PyBool\_FromLong}
		\begin{lstlisting}[language=C++]
   static PyObject*
united_kingdom_is_business_day(PyObject *self, PyObject *args)
{
    // ...
    QuantLib::Date date(d, m, y);
    QuantLib::UnitedKingdom calendar(QuantLib::UnitedKingdom::Exchange);
    bool result = calendar.isBusinessDay(date);
    return PyBool_FromLong(result);
}
 		\end{lstlisting}
	\end{frame}


	\section{Building a Python module}

	\subsection{PyMethodDef}
	\begin{frame}[fragile]
		\frametitle{PyMethodDef}
		\begin{lstlisting}[language=C++]
static PyMethodDef QuantucciaMethods[] = {
    {
        "united_kingdom_is_business_day",
        (PyCFunction)united_kingdom_is_business_day,
        METH_VARARGS,
        NULL
    },
    {NULL, NULL, 0, NULL}
};
		\end{lstlisting}
	\end{frame}

	\subsection{PyModuleDef}
	\begin{frame}[fragile]
		\frametitle{PyModuleDef}
		\begin{lstlisting}[language=C++]
static struct PyModuleDef quantuccia_module_def = {
    PyModuleDef_HEAD_INIT,
    "quantuccia",
    NULL,
    -1,
    QuantucciaMethods,
    NULL,
    NULL,
    NULL,
    NULL
};
		\end{lstlisting}
	\end{frame}

	\subsection{PyMODINIT\_FUNC}
	\begin{frame}[fragile]
		\frametitle{PyMODINIT\_FUNC}
		\begin{lstlisting}[language=C++]
PyMODINIT_FUNC PyInit_quantuccia(void){
    PyObject *m;
    m = PyModule_Create(\&quantuccia_module_def);
    return m;
}
		\end{lstlisting}
	\end{frame}

	\section{Putting together the Python package}

	\subsection{calendar.py}
	\begin{frame}[fragile]
		\frametitle{calendar.py}
		\begin{lstlisting}[language=Python]
from quantuccia import united_kingdom_is_business_day as c_function


def united_kingdom_is_business_day(dt):
    y = dt.year
    m = dt.month
    d = dt.day
    return c_function(y, m, d)
		\end{lstlisting}
	\end{frame}

	\subsection{setuptools.Extension}
	\begin{frame}[fragile]
		\frametitle{setuptools.Extension}
		\begin{lstlisting}[language=Python]
import setuptools

qu_ext = setuptools.Extension(
    'quantuccia',
    include_dirs=['src/Quantuccia'] + extra_dirs,   
    sources=['src/pyQuantuccia.cpp'],
    headers=[]
)
		\end{lstlisting}
	\end{frame}

	\subsection{setup}
	\begin{frame}[fragile]
		\frametitle{setup}
		\begin{lstlisting}[language=Python]
setuptools.setup(
    name='pyQuantuccia',
    author='Jack Grahl',
    author_email='jack.grahl@gmail.com',
    version='0.2.0',
    packages=['pyQuantuccia'],
    package_dir={'': 'src'},
    setup_requires=['pytest-runner'],
    tests_require=['pytest'],
    test_suite='tests',
    ext_modules=[qu_ext]
)		\end{lstlisting}
	\end{frame}

\end{document}